<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 12: Compiling the work that I have done so far for the poster creation – IS Project Logbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a14e3238c51140e99ccc48519b6ed9ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IS Project Logbook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-logs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Logs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-logs">    
        <li>
    <a class="dropdown-item" href="../weekly-logs/week01.html">
 <span class="dropdown-text">Week 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week02.html">
 <span class="dropdown-text">Week 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week03.html">
 <span class="dropdown-text">Week 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week04.html">
 <span class="dropdown-text">Week 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week05.html">
 <span class="dropdown-text">Week 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week06.html">
 <span class="dropdown-text">Week 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week07.html">
 <span class="dropdown-text">Week 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week08.html">
 <span class="dropdown-text">Week 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week09.html">
 <span class="dropdown-text">Week 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week10.html">
 <span class="dropdown-text">Week 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week11.html">
 <span class="dropdown-text">Week 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week12.html">
 <span class="dropdown-text">Week 12</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul>
  <li><a href="#understand-eris-codebase-week-04" id="toc-understand-eris-codebase-week-04" class="nav-link" data-scroll-target="#understand-eris-codebase-week-04">Understand eris codebase (week 04)</a></li>
  <li><a href="#run-eris-on-the-draft-assembly-of-ec958-week-05" id="toc-run-eris-on-the-draft-assembly-of-ec958-week-05" class="nav-link" data-scroll-target="#run-eris-on-the-draft-assembly-of-ec958-week-05">Run eris on the draft assembly of EC958 (week 05)</a></li>
  <li><a href="#run-eris-on-the-simmulated-draft-assembly-of-ec958-week-06" id="toc-run-eris-on-the-simmulated-draft-assembly-of-ec958-week-06" class="nav-link" data-scroll-target="#run-eris-on-the-simmulated-draft-assembly-of-ec958-week-06">Run eris on the “simmulated” draft assembly of EC958 (week 06)</a></li>
  <li><a href="#reannotated-the-ec958-is-elements-week-07" id="toc-reannotated-the-ec958-is-elements-week-07" class="nav-link" data-scroll-target="#reannotated-the-ec958-is-elements-week-07">Reannotated the EC958 IS elements (week 07)</a></li>
  <li><a href="#collapse-the-is-graph-week-07" id="toc-collapse-the-is-graph-week-07" class="nav-link" data-scroll-target="#collapse-the-is-graph-week-07">Collapse the IS graph (week 07)</a></li>
  <li><a href="#pyrodigal-vs-fraggenescan-week-07" id="toc-pyrodigal-vs-fraggenescan-week-07" class="nav-link" data-scroll-target="#pyrodigal-vs-fraggenescan-week-07">Pyrodigal vs FragGeneScan (week 07)</a></li>
  <li><a href="#minimap2-configuration-for-eris-week-08" id="toc-minimap2-configuration-for-eris-week-08" class="nav-link" data-scroll-target="#minimap2-configuration-for-eris-week-08">minimap2 configuration for eris (week 08)</a></li>
  <li><a href="#made-improvement-of-ec958-is-annotation-week-09" id="toc-made-improvement-of-ec958-is-annotation-week-09" class="nav-link" data-scroll-target="#made-improvement-of-ec958-is-annotation-week-09">Made improvement of EC958 IS annotation (week 09)</a></li>
  <li><a href="#tested-the-assemb-ly-result-on-pseudor-week-09" id="toc-tested-the-assemb-ly-result-on-pseudor-week-09" class="nav-link" data-scroll-target="#tested-the-assemb-ly-result-on-pseudor-week-09">Tested the assemb ly result on pseudoR (week 09)</a></li>
  <li><a href="#tested-graph-collapsing-on-the-real-dataset-week-10" id="toc-tested-graph-collapsing-on-the-real-dataset-week-10" class="nav-link" data-scroll-target="#tested-graph-collapsing-on-the-real-dataset-week-10">Tested graph collapsing on the real dataset (week 10)</a></li>
  <li><a href="#made-comaprison-of-cds-and-is-relationship-from-eris-against-the-truth-week-11" id="toc-made-comaprison-of-cds-and-is-relationship-from-eris-against-the-truth-week-11" class="nav-link" data-scroll-target="#made-comaprison-of-cds-and-is-relationship-from-eris-against-the-truth-week-11">Made comaprison of CDS and IS relationship from eris against the truth (week 11)</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 12: Compiling the work that I have done so far for the poster creation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>This I summarised the work that I has done for couple weeks</p>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<section id="understand-eris-codebase-week-04" class="level3">
<h3 class="anchored" data-anchor-id="understand-eris-codebase-week-04">Understand eris codebase (week 04)</h3>
<p>Eris is written on python with the mindset of portability and use few dependencies also has robust and easy to use API. Eris scan IS elements in the given sequence in fasta or gfa format in following steps:</p>
<ul>
<li>Eris scan pipeline, using minimap2 at core, will align IS elementt sequence from ISfinder database against the input sequence, and can accept contigs or full sequence</li>
<li>The resulted alignment then sorted and culled to get high scoring query in that region, eris then will tag IS element as “mobile_element”</li>
<li>Eris also will predict CDS using pyrodigal</li>
<li>Eris search the promoters in the sequence using regular expression, then convert the sequence into feature graph to represent the correlartion CDS, IS element, and promoter</li>
<li>We imolemented breadth first seach (BFS) to find the CDS that either part of the element (inside) or adjacent of the IS elements</li>
<li>Eris reports the location of IS with resepct of each CDS (downsteam, upstream, flanking, and insdie), and based on that, it predict the raltive effect of the IS element to CDS feature</li>
</ul>
</section>
<section id="run-eris-on-the-draft-assembly-of-ec958-week-05" class="level3">
<h3 class="anchored" data-anchor-id="run-eris-on-the-draft-assembly-of-ec958-week-05">Run eris on the draft assembly of EC958 (week 05)</h3>
<ul>
<li><p>Downloaded the fastq of EC958 from <a href="https://www.ebi.ac.uk/ena/browser/view/SRR5194982">SRR5194982</a>, and assembled it using <a href="https://github.com/ablab/spades">SPades</a>, and appied it to <code>eris scan</code> pipeline. I tried to give eris input of both contigs fasta and graph GFA. I also ran <a href="https://github.com/xiezhq/ISEScan"><code>isescan</code></a> to the same dataset for a little comparison.</p></li>
<li><p>I also downloaded full chromosome of EC958 and the genebank file of EC958 with the IS annotations on it. I extract the IS element and convert it to bed file. These two files will be treated as the ground truth IS elements inside the isolate.</p></li>
<li><p>There are, originally, 41 IS elements inside EC958 chromosome (this will change). 12 IS annotated from EC958 plasmid sequence.</p></li>
<li><p>Eris found 139 IS elements from the GFA file and and 66 from the fasta file of SPades. More IS detected here because, the resulted assembly also consist of plasmid and the GFA file has more because it still has the overlap sequence so it might appear the redundant calling</p></li>
<li><p>Isescan also report more IS element form the resulted assembly, 58 and 77 from fasta and GFA, respectively.</p></li>
</ul>
</section>
<section id="run-eris-on-the-simmulated-draft-assembly-of-ec958-week-06" class="level3">
<h3 class="anchored" data-anchor-id="run-eris-on-the-simmulated-draft-assembly-of-ec958-week-06">Run eris on the “simmulated” draft assembly of EC958 (week 06)</h3>
<ul>
<li><p>Eris identified 58 (37 predicted IS intersect with truth IS) IS elements in the complete chromosome, also missed four IS elements:</p>
<ul>
<li>After inspection, we found:
<ul>
<li>two of four missed IS are very short IS, and have relatively low identitity</li>
<li>overcall results from Eris mostly because it called very short IS in the chromosome</li>
</ul></li>
</ul></li>
<li><p>Isescan detected 65 IS elements in the EC958 chromosome</p></li>
<li><p>I simulated illumina paired end fastq of EC958 chromosome using <a href="https://github.com/YU-Zhejian/art_modern"><code>art_illumina</code></a>. We use this simulation reads so that the resulted assembly will consist of chromosome and also make sure this data come from single cell (clone), reduce the nose from different genetic composition.</p></li>
<li><p>Using <code>shovill</code>, bacterial genome assembler, I assembled the simulated reads.</p></li>
<li><p>Eris detected 90 IS elements both from GFA and fasta files of simulated assembly</p></li>
<li><p>On the draft assembly result, one IS element can split into multiple contigs, and both eris and isescan detect that one IS element separately across the corresponding contig, making the count inflated</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/IS1397.png" class="img-fluid figure-img"></p>
<figcaption>IS1397</figcaption>
</figure>
</div>
<p>For instance this IS element: IS1397</p>
<p>Two copies of IS1397 are fragmented into six IS identifeid contigs, make the call double. We further confirm that node in the middle also consist of frgamented IS1397 element.</p>
<p>This fragmented IS also found in the mason simulated fastq, and also found in the real fastq assembly.</p>
</section>
<section id="reannotated-the-ec958-is-elements-week-07" class="level3">
<h3 class="anchored" data-anchor-id="reannotated-the-ec958-is-elements-week-07">Reannotated the EC958 IS elements (week 07)</h3>
<ul>
<li>From manual curration on the ISfinder website, we include MITEEc1, IS1397, IS100kyp, ISKox3, ISEch14, ISEc10, IS21 elements as true IS on the EC958</li>
</ul>
</section>
<section id="collapse-the-is-graph-week-07" class="level3">
<h3 class="anchored" data-anchor-id="collapse-the-is-graph-week-07">Collapse the IS graph (week 07)</h3>
<ul>
<li><p>By graph traversal logic, fragmented IS sequnces (nodes in the graph) can be collapsed and the IS copies can be quantified by their contig depths relative to the median depth</p></li>
<li><p>This approach will help eris find path of fragmented IS and collapse them into one path, also can make more accurate prediction on the how many IS copies in the given input draft assembly</p></li>
<li><p>For example:</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/IS1397.png" class="img-fluid figure-img"></p>
<figcaption>IS1397</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/collapsed_IS397.png" class="img-fluid figure-img"></p>
<figcaption>Collapesd IS1397</figcaption>
</figure>
</div>
</section>
<section id="pyrodigal-vs-fraggenescan-week-07" class="level3">
<h3 class="anchored" data-anchor-id="pyrodigal-vs-fraggenescan-week-07">Pyrodigal vs FragGeneScan (week 07)</h3>
<ul>
<li>FragGeneScan metrics:
<ul>
<li>Precision (How many predicted ORF are true): 0.897</li>
<li>Sensitivity (How many true ORF are recovered): 0.99</li>
</ul></li>
<li>Pyrodigal metrics:
<ul>
<li>Precision (How many predicted ORF are true): 0.992 = Sensitivity (How many true ORF are recovered): 0.961</li>
</ul></li>
</ul>
<p><code>FragGeneScanRs</code> detected more ORFs than <code>Pyrodgial</code>. It is more sensitive than <code>Pyrodgial</code>, but has lower precision score.</p>
</section>
<section id="minimap2-configuration-for-eris-week-08" class="level3">
<h3 class="anchored" data-anchor-id="minimap2-configuration-for-eris-week-08">minimap2 configuration for eris (week 08)</h3>
<ul>
<li>minimap2 missed four IS using the default settings and setup to map IS elements against the genome sequence</li>
<li>With other preset, minimap2 also failed to detect all IS in the genome</li>
<li>However, we can detect all IS elements in the genome with the setup mapping the genome sequence to ISfinder sequence</li>
<li>Heng Li approves this <a href="https://github.com/lh3/minimap2/issues/1322">here</a></li>
<li>With the help of copilot, we think that by use the ISfinder as the reference, minimap2 will index all list of IS elements and query sequence from the genome will be search against all the IS sequence, this will make sensitivity increased</li>
</ul>
</section>
<section id="made-improvement-of-ec958-is-annotation-week-09" class="level3">
<h3 class="anchored" data-anchor-id="made-improvement-of-ec958-is-annotation-week-09">Made improvement of EC958 IS annotation (week 09)</h3>
<ul>
<li>Dimas has rewritten IS annotation of EC958, in a total of 49 IS elements identified in the chromosome sequence. For IS name with multiple copies, each copy is labeled with a suffix _1, _2, _3, and so on.</li>
</ul>
</section>
<section id="tested-the-assemb-ly-result-on-pseudor-week-09" class="level3">
<h3 class="anchored" data-anchor-id="tested-the-assemb-ly-result-on-pseudor-week-09">Tested the assemb ly result on pseudoR (week 09)</h3>
<ul>
<li><a href="https://github.com/joshuakirsch/pseudoR"><code>pseudoR</code></a> gives different result of IS detection than <code>eris</code> and <code>isescan</code>.</li>
<li>This tool requires the user to give the fastq reads and also reference genomoe. It will look where the moving insertion event happening throughout the genome</li>
<li>Using real fastq and EC958 chromosome as the reference, it detected IS in the contigs where it was n ot detected by <code>eris</code> and <code>isescan</code>.</li>
</ul>
</section>
<section id="tested-graph-collapsing-on-the-real-dataset-week-10" class="level3">
<h3 class="anchored" data-anchor-id="tested-graph-collapsing-on-the-real-dataset-week-10">Tested graph collapsing on the real dataset (week 10)</h3>
<ul>
<li>It successfully find contigs path and correctly predict copy number for several IS elements, such as ISEc23, IS1F, ISSd1, and ISEc8, others are miscounted by 1 margin such as ISEc12, IS609, and ISEc9, others miscounted by big margin such as IS26 and IS15.</li>
<li>Several contigs that have low coverage againts ISfinder sequences have very high depth, making it overestimated IS copies in total. Most of them are IS elements from the plasmid</li>
</ul>
</section>
<section id="made-comaprison-of-cds-and-is-relationship-from-eris-against-the-truth-week-11" class="level3">
<h3 class="anchored" data-anchor-id="made-comaprison-of-cds-and-is-relationship-from-eris-against-the-truth-week-11">Made comaprison of CDS and IS relationship from eris against the truth (week 11)</h3>
<ul>
<li>The main goal is: to identify which CDS may be impacted by IS elements (as predicted by Eris from GFA) and to evaluate how similar these predictions are to the truth annotation, particularly in terms of the IS element locations relative to the chromosome sequence.</li>
</ul>
<p><strong>Using mapping approach</strong> - The CDS predicted by eris are extracted and mapped them to the chromosome sequence - From there we can assess how well eris (without complete sequence information) predict the IS element location relative to the CDS - All the exracted predicted CDS from gfa file were succesfully mapped to the reference sequence uniquely. - All those sequences intersect with at least small fraction with known/truth CDS (they mostly are actually CDS). This can confrom that most of CDS predicted by eris are correct. - Most of the time, eris correctly predicted the CDS are inside the IS - Most of the time, eris incorrectly predicted between downstream and upstream, confised between two - Most of the time eris correctly predicted the corresponding IS for each predicted CDS</p>
<p><strong>using clustering approach</strong></p>
<ul>
<li>The extract CDS sequences from predicted eris combined with all truht CDS sequences are ran to the mmseq2 clustering</li>
<li>55 cluster consited of both source of CDS sequences, and 118 cluster that consist only the CDS from eris.</li>
<li>So it means that, 55 CDS are indded correct CDS based on the ground truth from the annotation</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/adimascf\.github\.io\/logbook-IS\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>