<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 11: Assessing Eris Element Locations from GFA Relative to the Complete Chromosome; Clustering Sequences from ISOSDB and ISfinder – IS Project Logbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a14e3238c51140e99ccc48519b6ed9ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IS Project Logbook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-logs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Logs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-logs">    
        <li>
    <a class="dropdown-item" href="../weekly-logs/week01.html">
 <span class="dropdown-text">Week 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week02.html">
 <span class="dropdown-text">Week 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week03.html">
 <span class="dropdown-text">Week 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week04.html">
 <span class="dropdown-text">Week 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week05.html">
 <span class="dropdown-text">Week 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week06.html">
 <span class="dropdown-text">Week 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week07.html">
 <span class="dropdown-text">Week 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week08.html">
 <span class="dropdown-text">Week 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week09.html">
 <span class="dropdown-text">Week 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week10.html">
 <span class="dropdown-text">Week 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week11.html">
 <span class="dropdown-text">Week 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../weekly-logs/week12.html">
 <span class="dropdown-text">Week 12</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul>
  <li><a href="#daily-log" id="toc-daily-log" class="nav-link" data-scroll-target="#daily-log">Daily Log</a>
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">07-10-2025</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">09-10-2025</a>
  <ul>
  <li><a href="#assess-effect-prediction-my-second-attempt" id="toc-assess-effect-prediction-my-second-attempt" class="nav-link" data-scroll-target="#assess-effect-prediction-my-second-attempt">Assess effect prediction (my second attempt)</a></li>
  </ul></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">12-10-2025</a>
  <ul>
  <li><a href="#using-clustering-mmseq2" id="toc-using-clustering-mmseq2" class="nav-link" data-scroll-target="#using-clustering-mmseq2">Using clustering MMSEQ2</a>
  <ul>
  <li><a href="#extract-cds-sequence-from-complete-chromosome" id="toc-extract-cds-sequence-from-complete-chromosome" class="nav-link" data-scroll-target="#extract-cds-sequence-from-complete-chromosome">Extract CDS sequence from complete chromosome</a></li>
  <li><a href="#run-eris-with-annotation-file" id="toc-run-eris-with-annotation-file" class="nav-link" data-scroll-target="#run-eris-with-annotation-file">Run eris with annotation file</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 11: Assessing Eris Element Locations from GFA Relative to the Complete Chromosome; Clustering Sequences from ISOSDB and ISfinder</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<p>This week, I evaluated Eris’s performance in predicting gene locations affected by insertion sequences (IS) using draft assemblies (GFA) and compared the predictions against the complete reference chromosome and its truth feature annotation.</p>
<p>I also performed clustering of IS sequences from ISfinder and ISOSDB using MMseqs2 to assess database similarity. Then, I clustered predicted and reference CDS sequences to evaluate their sequence similarity and overlap.</p>
<section id="daily-log" class="level2">
<h2 class="anchored" data-anchor-id="daily-log">Daily Log</h2>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">07-10-2025</h3>
<ul>
<li>Weekly project meeting
<ul>
<li>Tom has pushed changes of eris</li>
<li>We can try making ground truth of predicted genes, and manually looking</li>
<li>Cluster the sequences from ISOSDB and ISfinder, see how many or much intersection between those two</li>
<li>Dimas needs to start drafting the poster and report, focus on EC958</li>
<li>Important dates:
<ul>
<li>This week: finalise analysis (all above)</li>
<li>20th October: Draft of poster (comments back by Friday 25th)</li>
<li>27th October: Draft of report (comments back by Wednesday 5th Nov)</li>
<li>28th October: poster presentation to Jane</li>
<li>29th October: poster presentation at SCMB</li>
<li>6th November: Seminar presentation (2pm Bris - 3pm Melb)</li>
<li>10th November: final report due</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">09-10-2025</h3>
<section id="assess-effect-prediction-my-second-attempt" class="level4">
<h4 class="anchored" data-anchor-id="assess-effect-prediction-my-second-attempt">Assess effect prediction (my second attempt)</h4>
<p>The main goal is: to identify which CDS may be impacted by IS elements (as predicted by Eris from GFA) and to evaluate how similar these predictions are to the truth annotation, particularly in terms of the IS element locations relative to the chromosome sequence.</p>
<p>First approach using mapping:</p>
<ul>
<li>First I extracted the predicted CDS from eris (GFA) in fasta fomat, in header I added information on what the element effect, location, and nearest IS name</li>
<li>I got the fasta sequence with useful information, then I mapped them against EC958 chromosome, look where are predicted CDS from <strong>draft assembly</strong> relative to the chromosome</li>
<li>Extract the location where the predicted CDS mapped, then I intersect them with “ground truth CDS” with at least 50% intersection</li>
<li>Those that passed through the fraction threshold, I added them a flank 500 bp each at both ends (to allow intersection in the next step)</li>
<li>Then I intersect them against <strong>IS ground truth</strong></li>
<li>From there, we can answer the <strong>concordance</strong> of the IS elements and CDS relationship predicted from GFA to truth CDS IS truth annotation from chromosome, right?</li>
</ul>
<p>Read the result from eris, and thenn extract CDS information including the corresponding IS that might be impacted, location, strand, .</p>
<div id="e128846c" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>is_elements <span class="op">=</span> defaultdict(<span class="bu">str</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>cds_features <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"eris-outputs/eris_gfa_shovill_sim.tsv"</span>) <span class="im">as</span> output:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  head <span class="op">=</span> output.readline()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  rows <span class="op">=</span> output.readlines()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> r <span class="kw">in</span> rows:</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> r.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="dv">2</span>] <span class="op">==</span> <span class="st">"mobile_element"</span>:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      is_elements[row[<span class="dv">1</span>]] <span class="op">=</span> row[<span class="dv">15</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> r <span class="kw">in</span> rows:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> r.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="dv">2</span>] <span class="op">==</span> <span class="st">"CDS"</span>:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      contig <span class="op">=</span> row[<span class="dv">3</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      start <span class="op">=</span> row[<span class="dv">4</span>]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      end <span class="op">=</span> row[<span class="dv">5</span>]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      seq_strand <span class="op">=</span> row[<span class="dv">6</span>]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      effect <span class="op">=</span> row[<span class="dv">12</span>]</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      location <span class="op">=</span> row[<span class="dv">10</span>]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      strand <span class="op">=</span> row[<span class="dv">11</span>].replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      is_name <span class="op">=</span> is_elements[row[<span class="dv">8</span>]]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      cds_features[row[<span class="dv">1</span>]]<span class="op">=</span> [contig, start, end, seq_strand, effect, location, strand, is_name]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Extract CDS sequence from Eris</strong></p>
<p>Identify CDS sequence that may be imacted by insertion from Eris, and extract the coding sequence from the gfa file</p>
<div id="ceee6b4e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> eris.io <span class="im">import</span> SeqFile</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> eris.seq <span class="im">import</span> Record</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>the_gfa <span class="op">=</span> SeqFile(<span class="st">"../../data/ecoli/assembly-simulated/shovill-outputs/contigs.gfa"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>nodes_seq <span class="op">=</span> defaultdict(<span class="bu">str</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> entry <span class="kw">in</span> the_gfa:</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">isinstance</span>(entry, Record):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    nodes_seq[entry.<span class="bu">id</span>] <span class="op">=</span> entry.seq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5cbc4b82" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> writeFasta(seqname: <span class="bu">str</span>, sequence: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Write one sequence in FASTA format to a string and return it. This will split the sequence per 60 bp per line.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  fasta <span class="op">=</span> <span class="st">"&gt;"</span> <span class="op">+</span> seqname <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  nlines <span class="op">=</span> <span class="bu">int</span>(math.ceil((<span class="bu">len</span>(sequence) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">60</span> <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(nlines):</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      lineofseq <span class="op">=</span> <span class="st">""</span>.join(sequence[i <span class="op">*</span> <span class="dv">60</span> : (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span>]) <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      fasta <span class="op">+=</span> lineofseq</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> fasta</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reverse_complement(sequence: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">  make reverse complement of the input sequence</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">  """</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> <span class="st">""</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  complement <span class="op">=</span> {<span class="st">"A"</span> : <span class="st">"T"</span>, <span class="st">"T"</span>: <span class="st">"A"</span>, <span class="st">"G"</span>: <span class="st">"C"</span>, <span class="st">"C"</span>: <span class="st">"G"</span>}</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> b <span class="kw">in</span> sequence:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    result <span class="op">+=</span> complement[b]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result[::<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1d62e353" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re, os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    os.remove(<span class="st">"cds_gfa_shovill_is.fna"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat, info <span class="kw">in</span> cds_features.items():</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  name <span class="op">=</span> <span class="st">"|"</span>.join([feat, info[<span class="dv">0</span>], info[<span class="dv">4</span>], info[<span class="dv">5</span>], info[<span class="dv">6</span>], info[<span class="dv">7</span>]])</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  seq <span class="op">=</span> nodes_seq[info[<span class="dv">0</span>]]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if the feature has minus stran, we reverse complement the sequence</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> info[<span class="dv">3</span>] <span class="op">==</span> <span class="st">"-1"</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    seq <span class="op">=</span> reverse_complement(seq)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  start, end <span class="op">=</span> <span class="bu">int</span>(info[<span class="dv">1</span>]), <span class="bu">int</span>(info[<span class="dv">2</span>])</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  subseq <span class="op">=</span> <span class="bu">str</span>(seq[start:end])</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  fasta <span class="op">=</span> writeFasta(name, subseq)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cds_gfa_shovill_is.fna"</span>, <span class="st">"a"</span>) <span class="im">as</span> output:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    output.write(fasta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare predicted CDS (from GFA) to “truth” CDS (from NCBI chromosome)</p>
<div id="a2b7cab1" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wc <span class="op">-</span>l ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958_genomic_sorted.cds.edit.bed <span class="co"># this is cds bed file from NCBI</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>grep <span class="st">"^&gt;"</span> cds_gfa_shovill_is.fna <span class="op">|</span> wc <span class="op">-</span>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    5093 ../../data/ecoli/EC958_genomic_sorted.cds.edit.bed
     183</code></pre>
</div>
</div>
<p>so there are 5093 CDS in total from chromosome sequence, and 183 that might be impacted by insertions (near identifeied IS)</p>
<p>Let’s search where those 183 cds located in the genome, and are the location with respect of insertion elements similar or no</p>
<p>First, i think we can just map the <strong>predicted cds (from eris)</strong>.. and look where are they, relative to the chromosome, then we can look whether there are annotated IS near them, right? 🤔</p>
<p><strong>map cds from eris to chromosome, using minimap:</strong></p>
<div id="91c8f3b6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using preset short read, because cds sequences are short</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>minimap2 <span class="op">-</span>x sr ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.fasta cds_gfa_shovill_is.fna <span class="op">&gt;</span> cds_is_to_chrom.paf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[M::mm_idx_gen::0.073*1.10] collected minimizers
[M::mm_idx_gen::0.086*1.38] sorted minimizers
[M::main::0.086*1.38] loaded/built the index for 1 target sequence(s)
[M::mm_mapopt_update::0.087*1.37] mid_occ = 1000
[M::mm_idx_stat] kmer size: 21; skip: 11; is_hpc: 0; #seq: 1
[M::mm_idx_stat::0.092*1.35] distinct minimizers: 834905 (98.89% are singletons); average occurrences: 1.020; average spacing: 6.000; total length: 5109767
[M::worker_pipeline::0.095*1.39] mapped 183 sequences
[M::main] Version: 2.30-r1287
[M::main] CMD: minimap2 -x sr ../../data/ecoli/EC958.fasta cds_gfa_shovill_is.fna
[M::main] Real time: 0.098 sec; CPU: 0.134 sec; Peak RSS: 0.077 GB</code></pre>
</div>
</div>
<p>how many cds from eris were successfully mapped to chrom sequence?</p>
<div id="a08207ab" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wc <span class="op">-</span>l cds_is_to_chrom.paf</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cut <span class="op">-</span>f <span class="dv">1</span> cds_is_to_chrom.paf  <span class="op">|</span> sort <span class="op">|</span> uniq <span class="op">|</span> wc <span class="op">-</span>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     183 cds_is_to_chrom.paf
     183</code></pre>
</div>
</div>
<p>all of them, and each of them is mapped uniqely..</p>
<p>extract the location information, where are they realtive to the chromosome coordinate and also corresponding eris information (make a bed file)</p>
<div id="7e955cca" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4th field is for query name (cds and coresponding insertion info from eris)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 5th field is for alignment score from minimap</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 6th strand info from minimap2</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>awk <span class="op">-</span>v OFS<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span> <span class="st">'{print $6, $8, $9, $1, $12, $5}'</span> cds_is_to_chrom.paf <span class="op">&gt;</span> cds_is_to_chrom.bed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>look intersection between mapped cds here with cds coordinate from the truth (ncbi),</li>
<li>add flank at both ends for each entries (to allow intersection happens), and instersect them again with IS locations (reanotatated truth). Add flank so that we know how close the cds (predicted from gfa) to the IS elements (from truth chromosome) are</li>
<li>save into file for checking similarty on the location, strandness, and we can assess how well eris predict the location</li>
</ul>
<div id="075e8e04" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the entry</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>bedtools sort <span class="op">-</span>i cds_is_to_chrom.bed <span class="op">&gt;</span> cds_is_to_chrom.<span class="bu">sorted</span>.bed</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># intersect them with known cds, with at least 50% fraction</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>bedtools intersect <span class="op">-</span>a cds_is_to_chrom.<span class="bu">sorted</span>.bed <span class="op">-</span>b ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958_genomic_sorted.cds.edit.bed <span class="op">-</span>f <span class="fl">0.5</span> <span class="op">-</span>wa <span class="op">|</span> bedtools slop <span class="op">-</span>i <span class="op">-</span> <span class="op">-</span>g ec958.genome.size <span class="op">-</span>b <span class="dv">1000</span> <span class="op">|</span> bedtools intersect <span class="op">-</span>a <span class="op">-</span> <span class="op">-</span>b ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>ec958_IS.reannotated.<span class="bu">sorted</span>.bed <span class="op">-</span>wa <span class="op">-</span>wb <span class="op">&gt;</span> cds_gfa_intersect_IS_truth.bed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="29f4be5b" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cut <span class="op">-</span>f <span class="dv">4</span> cds_gfa_intersect_IS_truth.bed <span class="op">|</span> sort <span class="op">|</span> uniq <span class="op">|</span> wc <span class="op">-</span>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     125</code></pre>
</div>
</div>
<p>From 183 cds, we have 125 that passed through series of intersection step. Most of them (if not all) did not pass when we intersect them (added with flank 1000 bp at both ends) to IS. Not sure but bedtools subcommand to extend the both flanks is <code>bedtools slop</code> not <code>bedtools flank</code>.</p>
<p>Some predicted CDS that don’t pass the intersection step look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/cds_wrong_predicted.png" class="img-fluid figure-img"></p>
<figcaption>No overlap with truth CDS</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/cds_misplaced.png" class="img-fluid figure-img"></p>
<figcaption>Little overlap with truth CDS</figcaption>
</figure>
</div>
<p>Check on the assignment of element location relative to the CDS. We assess the report come from eris using the ground truth IS and full chromosome.</p>
<p>Eris defines <strong>element_location</strong> as: <strong>Signifies the relative location of the Element from the current context</strong>.</p>
<p>So I can check if:</p>
<ul>
<li><p>Inside: the predicted CDS is part of truth IS</p></li>
<li><p>Downstream: the predicted CDS has IS element at its downstream (after the cds)</p></li>
<li><p>Upstream: the predicted CDS has IS element at its upstream (after the cds)</p></li>
<li><p>Flanking: the predicted CDS has an IS element overlapping it, but not fully inside.</p></li>
</ul>
<p>All of those condition, we checked with the chromosome info (eris only had contigs info when it predicted)</p>
<div id="eddd768f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>cds_elements <span class="op">=</span> defaultdict(<span class="bu">str</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cds_gfa_intersect_IS_truth.bed"</span>) <span class="im">as</span> entries:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  entries <span class="op">=</span> entries.readlines()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> entry <span class="kw">in</span> entries:</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    entry <span class="op">=</span> entry.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    cds_start <span class="op">=</span> <span class="bu">int</span>(entry[<span class="dv">1</span>]) <span class="op">+</span> <span class="dv">1000</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    cds_end <span class="op">=</span> <span class="bu">int</span>(entry[<span class="dv">2</span>]) <span class="op">-</span> <span class="dv">1000</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    is_start <span class="op">=</span> <span class="bu">int</span>(entry[<span class="dv">7</span>])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    is_end <span class="op">=</span> <span class="bu">int</span>(entry[<span class="dv">8</span>])</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    predicted_location <span class="op">=</span> entry[<span class="dv">3</span>].split(<span class="st">"|"</span>)[<span class="dv">3</span>]</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    is_precited <span class="op">=</span> entry[<span class="dv">3</span>].split(<span class="st">"|"</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    is_truth <span class="op">=</span> entry[<span class="dv">9</span>]</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    predicted_cds_strand <span class="op">=</span> entry[<span class="dv">5</span>]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    is_strand <span class="op">=</span> entry[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    length_cds <span class="op">=</span> cds_end <span class="op">-</span> cds_start</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inside</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> predicted_location <span class="op">==</span> <span class="st">"inside"</span>:</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> entry[<span class="dv">3</span>] <span class="kw">not</span> <span class="kw">in</span> cds_elements:</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"False"</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cds_start <span class="op">&gt;=</span> is_start <span class="kw">and</span> cds_end <span class="op">&lt;=</span> is_end: <span class="co"># part of the IS hit</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>          cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>          <span class="cf">continue</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># downstream</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> predicted_location <span class="op">==</span> <span class="st">"downstream"</span>:</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> entry[<span class="dv">3</span>] <span class="kw">not</span> <span class="kw">in</span> cds_elements:</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"False"</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> predicted_cds_strand <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>          check <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, cds_end <span class="op">-</span> is_start)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> check <span class="op">/</span> length_cds <span class="op">&lt;</span> <span class="fl">0.8</span>:</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>            cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elif</span> predicted_cds_strand <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>          check <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, is_end <span class="op">-</span> cds_start)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> check <span class="op">/</span> length_cds <span class="op">&lt;</span> <span class="fl">0.8</span>:</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>              cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>              <span class="cf">continue</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># upstream</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> predicted_location <span class="op">==</span> <span class="st">"upstream"</span>:</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> entry[<span class="dv">3</span>] <span class="kw">not</span> <span class="kw">in</span> cds_elements:</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"False"</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> predicted_cds_strand <span class="op">==</span> <span class="st">"+"</span>:</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>            check <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, is_end <span class="op">-</span> cds_start)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> check <span class="op">/</span> length_cds <span class="op">&lt;</span> <span class="fl">0.8</span>:</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>                cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> predicted_cds_strand <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>            check <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, cds_end <span class="op">-</span> is_start)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> check <span class="op">/</span> length_cds <span class="op">&lt;</span> <span class="fl">0.8</span>:</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>                cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> predicted_location <span class="op">==</span> <span class="st">"flanking"</span>:</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> entry[<span class="dv">3</span>] <span class="kw">not</span> <span class="kw">in</span> cds_elements:</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>        cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"False"</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    overlap <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(cds_end, is_end) <span class="op">-</span> <span class="bu">max</span>(cds_start, is_start))</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    overlap_fraction <span class="op">=</span> overlap <span class="op">/</span> length_cds</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> is_precited <span class="op">==</span> is_truth.split(<span class="st">"_"</span>)[<span class="dv">0</span>]:</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="fl">0.8</span> <span class="op">&lt;=</span> overlap_fraction <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>            cds_elements[entry[<span class="dv">3</span>]] <span class="op">=</span> <span class="st">"True"</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>true_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> v <span class="kw">in</span> cds_elements.values() <span class="cf">if</span> v <span class="op">==</span> <span class="st">"True"</span>)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>false_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> v <span class="kw">in</span> cds_elements.values() <span class="cf">if</span> v <span class="op">==</span> <span class="st">"False"</span>)</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(cds_elements)</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ele, val <span class="kw">in</span> cds_elements.items():</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(ele, val)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total CDS: </span><span class="sc">{</span>total<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Correct assignments: </span><span class="sc">{</span>true_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Incorrect assignments: </span><span class="sc">{</span>false_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>true_count <span class="op">/</span> total<span class="sc">:.2%}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1244700_00882|1244700|-|inside|same_strand|ISEc23 True
1244700_00883|1244700|-|inside|same_strand|ISEc23 True
1244816_01151|1244816|-|inside|same_strand|ISEc23 True
1176191_00082|1176191|-|flanking|opposite_strand|ISEc23 False
1245002_02024|1245002|disrupted|upstream|same_strand|ISCfr4 False
1245002_02025|1245002|-|inside|same_strand|ISCfr4 True
1245002_02026|1245002|-|downstream|same_strand|ISCfr4 False
1245002_02031|1245002|-|inside|opposite_strand|ISSen3 False
1244912_01169|1244912|-|flanking|same_strand|ISEc12 False
1245096_04606|1245096|-|inside|same_strand|ISEc1 True
1015060_00032|1015060|-|inside|same_strand|IS1397 True
1208211_00117|1208211|-|flanking|opposite_strand|IS1397 False
1234872_00176|1234872|-|inside|same_strand|IS1397 True
1241248_00251|1241248|-|inside|same_strand|IS1397 True
1244764_01147|1244764|-|inside|same_strand|IS609 True
832167_00019|832167|-|flanking|opposite_strand|IS609 False
1244458_00450|1244458|disrupted|upstream|opposite_strand|IS609 True
1244458_00486|1244458|-|flanking|same_strand|IS1397 False
1244458_00449|1244458|-|inside|same_strand|IS609 False
1244160_00403|1244160|-|inside|same_strand|IS1397 True
1208964_00119|1208964|-|inside|same_strand|IS1397 True
1216050_00137|1216050|-|inside|same_strand|IS1397 True
1241248_00250|1241248|-|inside|opposite_strand|IS1397 True
1244664_00858|1244664|-|flanking|same_strand|IS1397 False
1244018_00385|1244018|-|downstream|same_strand|IS200C False
1221552_00145|1221552|-|inside|same_strand|IS200C True
1241860_00257|1241860|-|flanking|opposite_strand|IS200C False
1244910_01167|1244910|disrupted|upstream|same_strand|IS200C False
1245062_04536|1245062|-|downstream|opposite_strand|ISEc38 True
1244402_00441|1244402|-|inside|same_strand|IS100kyp True
1244402_00440|1244402|-|inside|same_strand|IS100kyp True
1244402_00445|1244402|-|upstream|same_strand|ISEc20 False
1116087_00050|1116087|-|inside|same_strand|ISEc23 True
1240840_00244|1240840|-|flanking|opposite_strand|ISEc12 False
1221552_00144|1221552|-|inside|same_strand|IS200C True
1245038_03183|1245038|-|flanking|opposite_strand|IS1A False
1245136_04886|1245136|-|flanking|same_strand|IS1A False
1245136_04885|1245136|-|inside|opposite_strand|IS1B False
1245046_03736|1245046|-|flanking|opposite_strand|IS1A False
1245022_02114|1245022|disrupted|downstream|same_strand|MITEEc1 False
1245022_02113|1245022|disrupted|upstream|same_strand|MITEEc1 False
1171599_00078|1171599|-|inside|same_strand|IS1A True
1245138_04887|1245138|-|flanking|same_strand|IS1A False
1236016_00186|1236016|-|flanking|opposite_strand|IS1A False
1208153_00116|1208153|-|inside|same_strand|IS1A True
1244936_01278|1244936|-|flanking|opposite_strand|IS1A False
1244936_01276|1244936|-|downstream|opposite_strand|IS1203 True
1244936_01275|1244936|-|inside|same_strand|IS1203 True
1244936_01274|1244936|-|inside|same_strand|IS1203 True
1243600_00315|1243600|-|inside|same_strand|IS600 False
1243600_00328|1243600|-|inside|same_strand|IS3411 False
1245106_04649|1245106|-|flanking|same_strand|IS1F False
1243600_00316|1243600|disrupted|upstream|same_strand|IS600 False
1243600_00327|1243600|-|inside|same_strand|ISKox3 True
1242602_00264|1242602|-|inside|same_strand|IS30 True
1242602_00265|1242602|-|flanking|opposite_strand|IS600 False
1244674_00860|1244674|-|inside|same_strand|IS682 False
1244674_00861|1244674|-|inside|same_strand|IS682 False
1244674_00862|1244674|-|inside|same_strand|IS682 False
1244674_00878|1244674|-|upstream|opposite_strand|ISEc45 False
1244674_00874|1244674|-|downstream|same_strand|IS2 False
1244674_00873|1244674|-|inside|same_strand|IS2 True
1244674_00872|1244674|-|inside|same_strand|IS2 True
1244674_00871|1244674|disrupted|upstream|same_strand|IS2 False
1244674_00863|1244674|-|upstream|opposite_strand|IS682 True
1244674_00879|1244674|-|inside|same_strand|ISEch14 False
1244674_00880|1244674|-|inside|same_strand|ISEch14 False
1125059_00056|1125059|-|inside|same_strand|ISEc8 False
1240608_00243|1240608|-|inside|same_strand|ISEc22 True
1243212_00271|1243212|-|flanking|same_strand|ISEc22 True
1244994_01721|1244994|-|upstream|same_strand|ISKpn42 False
1244994_01722|1244994|-|inside|same_strand|ISKpn42 False
1244994_01723|1244994|-|inside|same_strand|ISEc10 True
1244994_01724|1244994|-|inside|same_strand|ISEc10 True
1244994_01725|1244994|-|downstream|same_strand|ISEc10 False
1244434_00447|1244434|-|inside|same_strand|ISEc52 True
1206755_00112|1206755|-|upstream|opposite_strand|IS600 False
1245082_04546|1245082|-|inside|same_strand|ISEc52 True
1245080_04545|1245080|-|inside|same_strand|ISEc52 True
1244570_00584|1244570|disrupted|downstream|opposite_strand|IS609 True
1244764_01146|1244764|disrupted|upstream|same_strand|IS609 False
1244706_00887|1244706|-|inside|same_strand|IS1F True
1202947_00109|1202947|-|inside|same_strand|IS1X2 False
1215098_00134|1215098|-|inside|same_strand|IS1F True
1236482_00188|1236482|-|inside|same_strand|IS1F True
1245106_04640|1245106|disrupted|downstream|same_strand|ISSen10 False
1245106_04639|1245106|-|inside|same_strand|ISSen10 True
1245106_04638|1245106|disrupted|upstream|same_strand|ISSen10 False
1002621_00031|1002621|-|flanking|opposite_strand|IS3411 False
1244656_00832|1244656|disrupted|upstream|opposite_strand|IS3411 False
1244656_00833|1244656|-|inside|same_strand|ISEc43 False
1244656_00844|1244656|-|inside|same_strand|ISCro1 True
1244656_00843|1244656|-|upstream|opposite_strand|ISCro1 False
1244656_00845|1244656|-|inside|same_strand|ISCro1 True
1244656_00846|1244656|-|inside|same_strand|ISCro1 True
1244656_00837|1244656|disrupted|upstream|same_strand|ISEc49 False
1245118_04670|1245118|-|flanking|opposite_strand|ISEc23 False
1244700_00884|1244700|-|inside|same_strand|ISEc23 True
1159225_00072|1159225|-|inside|same_strand|ISEc23 True
1245048_03750|1245048|-|flanking|opposite_strand|ISSd1 False
1245048_03746|1245048|-|inside|same_strand|ISEc9 True
1245048_03748|1245048|upregulated|downstream|same_strand|ISEc9 False
1243758_00330|1243758|-|inside|same_strand|ISSd1 False
976171_00026|976171|-|flanking|same_strand|IS600 False
1228204_00159|1228204|-|inside|same_strand|IS600 True
1206755_00111|1206755|-|inside|same_strand|IS600 True
1243586_00314|1243586|-|inside|same_strand|ISEc52 False
1158833_00071|1158833|-|inside|same_strand|IS1F True
1244320_00406|1244320|-|downstream|opposite_strand|ISEc8 True
1244320_00405|1244320|-|inside|same_strand|ISEc8 True
1244320_00407|1244320|-|inside|same_strand|IS1F False
1244320_00408|1244320|-|flanking|opposite_strand|IS1X2 False
1234604_00174|1234604|-|inside|same_strand|ISEc8 True
1235120_00177|1235120|-|flanking|opposite_strand|ISEc8 False
1236644_00191|1236644|-|inside|same_strand|ISEc8 True
1236644_00190|1236644|-|inside|same_strand|ISEc8 True
1236644_00189|1236644|-|inside|same_strand|ISEc8 True
1244742_00933|1244742|-|inside|same_strand|ISEc12 True
1244742_00934|1244742|-|inside|same_strand|ISEc12 True
1245024_02247|1245024|-|downstream|same_strand|IS911 False
1245024_02220|1245024|-|upstream|same_strand|ISSen1 False
1245024_02221|1245024|disrupted|downstream|same_strand|ISSen1 False
1244890_01166|1244890|-|flanking|same_strand|IS1F False
1244638_00699|1244638|-|inside|same_strand|ISEc53 True
1244638_00698|1244638|-|inside|same_strand|ISEc53 True
Total CDS: 125
Correct assignments: 61
Incorrect assignments: 64
Accuracy: 48.80%
</code></pre>
</div>
</div>
<p>We look closer, most of the incorrect assigments mistakenly assigned downstream location to upstream location, and vice versa.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/IS200C_wrong.png" class="img-fluid figure-img"></p>
<figcaption>IS200C</figcaption>
</figure>
</div>
<p><em>1244910_01167</em> has IS element IS200C at its downstream, and <em>1244018_00385</em> has IS element IS200C at its upstream</p>
<p>but eris says: 1244910_01167|1244910|disrupted|upstream|same_strand|IS200C False 1244018_00385|1244018|-|downstream|same_strand|IS200C False</p>
<p>CDS <em>1244910_01167</em> has IS element IS200C at its upstream, <em>1244018_00385</em> has IS element IS200C at its downstream.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISEc9_upr.png" class="img-fluid figure-img"></p>
<figcaption>ISEc9</figcaption>
</figure>
</div>
<p>the ISEc9 lies at the upstream of the CDS, but eris predicted at downstream.</p>
<p>1245048_03748|1245048|upregulated|downstream|same_strand|ISEc9 False</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISCfr4_dist_wrong.png" class="img-fluid figure-img"></p>
<figcaption>ISCfr4</figcaption>
</figure>
</div>
<p>Eris predicted: 1245002_02024|1245002|disrupted|upstream|same_strand|ISCfr4 False 1245002_02025|1245002|-|inside|same_strand|ISCfr4 True 1245002_02026|1245002|-|downstream|same_strand|ISCfr4 False</p>
<p>but: ISCfr4 lies at downstream of 1245002_02024, and it is at upstream 1245002_02026</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISEc53_no.png" class="img-fluid figure-img"></p>
<figcaption>ISEc53</figcaption>
</figure>
</div>
<p>Eris predicted ISEc53 at the downstream of the CDS, but it is at its upstream</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISSen10.png" class="img-fluid figure-img"></p>
<figcaption>ISSen10</figcaption>
</figure>
</div>
<p>Eris predicted ISSen10 at the upstream of the CDS 1245106_04638, but it is at downstrem of it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/IS2_confusing.png" class="img-fluid figure-img"></p>
<figcaption>IS2</figcaption>
</figure>
</div>
<p>Eris also predicted wrong here. It should be: IS2 lies at the downstream of 1244674_00871 and at the upstream of 1244674_00874</p>
<p><strong>Several correct assignments by Eris here</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISEc38_correct.png" class="img-fluid figure-img"></p>
<figcaption>ISEc38</figcaption>
</figure>
</div>
<p>1245062_04536|1245062|-|downstream|opposite_strand|ISEc38 True</p>
<p>ISEc38 element is at the downstream of CDS 1245062_04536</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/ISEc8_true.png" class="img-fluid figure-img"></p>
<figcaption>ISEc8</figcaption>
</figure>
</div>
<p>1244320_00406|1244320|-|downstream|opposite_strand|ISEc8 True</p>
<p>ISEc8 lies at the downstream of CDS 1244320_00406</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/IS609_corr_in.png" class="img-fluid figure-img"></p>
<figcaption>IS609</figcaption>
</figure>
</div>
<p>1244570_00584|1244570|disrupted|downstream|opposite_strand|IS609 True</p>
<p>Correct as the IS609 elements appear at the downstream of 1244570_00584</p>
<p>Check the entries that don’t pass intersection with IS, in theory they should not be reported for the insertion effect (because the proximity more than 150), no?</p>
<p><img src="pictures/ISEc1_far.png" class="img-fluid" alt="ISEc1"> Eris still predicted CDS 1245096_04607 will be disrupted, although it far from the nearest IS element ISec1 (&gt;150 bp) in the full chromosome</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/MITEEc1.png" class="img-fluid figure-img"></p>
<figcaption>MITEEc1</figcaption>
</figure>
</div>
<p>Eris the detec IS that don’t exist in truth, so they don’t overlap</p>
<p><strong>Summary</strong></p>
<ul>
<li>All the exracted predicted CDS from gfa file were succesfully mapped to the reference sequence uniquely.</li>
<li>All those sequences intersect with at least small fraction with known/truth CDS (they mostly are actually CDS)</li>
<li>Based on the checking using IGV and phython cod above, I can say:
<ul>
<li>Most of the time, eris correctly predicted the CDS are inside the IS</li>
<li>Most of the time, eris incorrectly predicted between downstream and upstream, confised between two</li>
<li>Most of the time eris correctly predicted the corresponding IS for each predicted CDS</li>
</ul></li>
<li>Some CDS that dont intersect with truth IS because their IS are overcalled by eris</li>
</ul>
</section>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2">12-10-2025</h3>
<section id="using-clustering-mmseq2" class="level4">
<h4 class="anchored" data-anchor-id="using-clustering-mmseq2">Using clustering MMSEQ2</h4>
<p><strong>cluster the ISfinder and ISOSDB using mmseqs2</strong></p>
<div id="b58bdabb" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat ..<span class="op">/</span>..<span class="op">/</span>ISOSDB.V3.fna ..<span class="op">/</span>..<span class="op">/</span>eris<span class="op">/</span>src<span class="op">/</span>eris<span class="op">/</span>data<span class="op">/</span>IS.fna <span class="op">&gt;</span> combined_ISOSDB_ISfinder.fna</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mmseqs easy<span class="op">-</span>cluster combined_ISOSDB_ISfinder.fna clusterIS tmp <span class="op">--</span><span class="bu">min</span><span class="op">-</span>seq<span class="op">-</span><span class="bu">id</span> <span class="fl">0.8</span> <span class="op">-</span>c <span class="fl">0.8</span> <span class="op">-</span>s <span class="dv">7</span> <span class="op">--</span>threads <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Look for the intersections</strong></p>
<div id="d26d1ea9" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"clusterIS_cluster.tsv"</span>) <span class="im">as</span> entries:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> entry <span class="kw">in</span> entries.readlines():</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    cluster, member <span class="op">=</span> entry.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    clusters[cluster].append(member)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(clusters)<span class="sc">}</span><span class="ss"> clusters"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># classify clusters</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>isosdb_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>isfinder_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>both <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>isosdb_clusters <span class="op">=</span> []</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>isfinder_clusters <span class="op">=</span> []</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>both_clusters <span class="op">=</span> []</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id, members <span class="kw">in</span> clusters.items():</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    has_isosdb <span class="op">=</span> <span class="bu">any</span>(m.startswith(<span class="st">"ISOSDB"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    has_isfinder <span class="op">=</span> <span class="bu">any</span>(<span class="kw">not</span> m.startswith(<span class="st">"ISOSDB"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> has_isosdb <span class="kw">and</span> has_isfinder:</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        both <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        both_clusters.append(cluster_id)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_isosdb:</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        isosdb_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        isosdb_clusters.append(cluster_id)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_isfinder:</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        isfinder_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        isfinder_clusters.append(cluster_id)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_venn <span class="im">import</span> venn2</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># sizes</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>only_isosdb <span class="op">=</span> <span class="bu">len</span>(isosdb_clusters)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>only_isfinder <span class="op">=</span> <span class="bu">len</span>(isfinder_clusters)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>overlap <span class="op">=</span> <span class="bu">len</span>(both_clusters)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Venn diagram</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>venn2(subsets<span class="op">=</span>(only_isosdb, only_isfinder, overlap), </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>      set_labels<span class="op">=</span>(<span class="st">"ISOSDB"</span>, <span class="st">"isfinder DB"</span>))</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cluster overlap"</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters with both ISOSDB and ISfinder:"</span>, both)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only ISOSDB:"</span>, isosdb_only)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only ISfinder:"</span>, isfinder_only)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 16655 clusters</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week11_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Clusters with both ISOSDB and ISfinder: 1775
Clusters only ISOSDB: 12397
Clusters only ISfinder: 2483</code></pre>
</div>
</div>
<section id="extract-cds-sequence-from-complete-chromosome" class="level5">
<h5 class="anchored" data-anchor-id="extract-cds-sequence-from-complete-chromosome">Extract CDS sequence from complete chromosome</h5>
<p>we can use seqkit to extract sequence from fasta format</p>
<div id="00335f84" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>seqkit subseq <span class="op">--</span>bed ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958_genomic_sorted.cds.edit.bed ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.fasta <span class="op">&gt;</span> cds_chrom_all.fna</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>combine with predicted CDS from eris, and run clustering using mmseq2 again. The predcited CDS sequence is expected to be intersected with the the truth CDS</p>
<div id="f5b51a27" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat cds_chrom_all.fna cds_gfa_shovill_is.fna <span class="op">&gt;</span> combined_cds_alltruth_eris.fna</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mmseqs easy<span class="op">-</span>cluster combined_cds_alltruth_eris.fna clusterCDSall tmp <span class="op">--</span><span class="bu">min</span><span class="op">-</span>seq<span class="op">-</span><span class="bu">id</span> <span class="fl">0.8</span> <span class="op">-</span>c <span class="fl">0.8</span> <span class="op">-</span>s <span class="dv">7</span> <span class="op">--</span>threads <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6371fb80" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"clusterCDSall_cluster.tsv"</span>) <span class="im">as</span> entries:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> entry <span class="kw">in</span> entries.readlines():</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    cluster, member <span class="op">=</span> entry.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    clusters[cluster].append(member)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(clusters)<span class="sc">}</span><span class="ss"> clusters"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># classify clusters</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>truth_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>predicted_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>both <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>truth_clusters <span class="op">=</span> []</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>predicted_clusters <span class="op">=</span> []</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>both_clusters <span class="op">=</span> []</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id, members <span class="kw">in</span> clusters.items():</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    has_truth <span class="op">=</span> <span class="bu">any</span>(m.startswith(<span class="st">"HG941718.1"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    has_predicted <span class="op">=</span> <span class="bu">any</span>(<span class="kw">not</span> m.startswith(<span class="st">"HG941718.1"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> has_truth <span class="kw">and</span> has_predicted:</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        both <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        both_clusters.append(cluster_id)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_truth:</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        truth_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        truth_clusters.append(cluster_id)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_predicted:</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        predicted_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        predicted_clusters.append(cluster_id)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_venn <span class="im">import</span> venn2</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co"># sizes</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>only_truth <span class="op">=</span> <span class="bu">len</span>(truth_clusters)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>only_predicted <span class="op">=</span> <span class="bu">len</span>(predicted_clusters)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>overlap <span class="op">=</span> <span class="bu">len</span>(both_clusters)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Venn diagram</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>venn2(subsets<span class="op">=</span>(only_truth, only_predicted, overlap),</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>      set_labels<span class="op">=</span>(<span class="st">"TRUTH"</span>, <span class="st">"predicted CDS"</span>))</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cluster overlap"</span>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters with both TRUTH and predicted:"</span>, both)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only TRUTH:"</span>, truth_only)</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only predicted:"</span>, predicted_only)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 4918 clusters</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week11_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Clusters with both TRUTH and predicted: 55
Clusters only TRUTH: 4745
Clusters only predicted: 118</code></pre>
</div>
</div>
<p>print cluster that have intersection from both:</p>
<div id="8e544dd9" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> clust, mem <span class="kw">in</span> clusters.items():</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  has_hg <span class="op">=</span> <span class="bu">any</span>(e.startswith(<span class="st">"HG"</span>) <span class="cf">for</span> e <span class="kw">in</span> mem)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  has_non_hg <span class="op">=</span> <span class="bu">any</span>(<span class="kw">not</span> e.startswith(<span class="st">"HG"</span>) <span class="cf">for</span> e <span class="kw">in</span> mem)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> has_hg <span class="kw">and</span> has_non_hg:</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Cluster </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mem<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster 1: ['HG941718.1_233813-234238:+\n', 'HG941718.1_2265919-2266344:+\n', 'HG941718.1_3334643-3335068:+\n', 'HG941718.1_4925174-4925599:+\n', '1244700_00882|1244700|-|inside|same_strand|ISEc23\n']
Cluster 2: ['HG941718.1_234235-234585:+\n', 'HG941718.1_2266341-2266691:+\n', 'HG941718.1_3335065-3335415:+\n', 'HG941718.1_4925596-4925946:+\n', '1244700_00883|1244700|-|inside|same_strand|ISEc23\n']
Cluster 3: ['HG941718.1_2104090-2104614:+\n', '1244458_00450|1244458|disrupted|upstream|opposite_strand|IS609\n']
Cluster 4: ['HG941718.1_2142533-2142991:-\n', 'HG941718.1_2284952-2285410:-\n', '1221552_00144|1221552|-|inside|same_strand|IS200C\n', '1241860_00257|1241860|-|flanking|opposite_strand|IS200C\n']
Cluster 5: ['HG941718.1_2385473-2386087:-\n', '1245046_03736|1245046|-|flanking|opposite_strand|IS1A\n']
Cluster 6: ['HG941718.1_1359686-1360138:+\n', '1245002_02033|1245002|-|inside|same_strand|ISEc24\n']
Cluster 7: ['HG941718.1_1629133-1629669:+\n', '1245096_04607|1245096|disrupted|downstream|opposite_strand|ISEc1\n']
Cluster 8: ['HG941718.1_3324614-3324929:-\n', '1244674_00872|1244674|-|inside|same_strand|IS2\n']
Cluster 9: ['HG941718.1_4156672-4158180:-\n', '1245106_04638|1245106|disrupted|upstream|same_strand|ISSen10\n']
Cluster 10: ['HG941718.1_4778064-4778639:-\n', '1245118_04681|1245118|-|upstream|same_strand|ISEc49\n']
Cluster 11: ['HG941718.1_4942430-4943337:-\n', 'HG941718.1_3314364-3315260:+\n', '1243758_00330|1243758|-|inside|same_strand|ISSd1\n']
Cluster 12: ['HG941718.1_4943337-4943586:-\n', 'HG941718.1_3312881-3313186:+\n', '1228204_00159|1228204|-|inside|same_strand|IS600\n']
Cluster 13: ['HG941718.1_4976216-4976365:+\n', '1245024_02220|1245024|-|upstream|same_strand|ISSen1\n']
Cluster 14: ['1111349_00049|1111349|-|flanking|same_strand|ISEc22\n', 'HG941718.1_3338120-3338305:-\n']
Cluster 15: ['1242602_00264|1242602|-|inside|same_strand|IS30\n', 'HG941718.1_3313206-3314357:+\n']
Cluster 16: ['1243600_00327|1243600|-|inside|same_strand|ISKox3\n', 'HG941718.1_3295132-3295881:-\n']
Cluster 17: ['1244320_00406|1244320|-|downstream|opposite_strand|ISEc8\n', 'HG941718.1_4954441-4955799:+\n']
Cluster 18: ['1244402_00440|1244402|-|inside|same_strand|IS100kyp\n', 'HG941718.1_2253124-2254146:-\n']
Cluster 19: ['1244402_00441|1244402|-|inside|same_strand|IS100kyp\n', 'HG941718.1_2252432-2253127:-\n']
Cluster 20: ['1244458_00486|1244458|-|flanking|same_strand|IS1397\n', 'HG941718.1_2134679-2135314:+\n']
Cluster 21: ['1244570_00584|1244570|disrupted|downstream|opposite_strand|IS609\n', 'HG941718.1_3819356-3820234:+\n']
Cluster 22: ['1244638_00698|1244638|-|inside|same_strand|ISEc53\n', 'HG941718.1_5016081-5016599:-\n']
Cluster 23: ['1244638_00699|1244638|-|inside|same_strand|ISEc53\n', 'HG941718.1_5014842-5016062:-\n']
Cluster 24: ['1244638_00700|1244638|-|downstream|same_strand|ISEc53\n', 'HG941718.1_5012444-5013160:-\n']
Cluster 25: ['1244656_00832|1244656|disrupted|upstream|opposite_strand|IS3411\n', 'HG941718.1_4159665-4160326:+\n']
Cluster 26: ['1244656_00844|1244656|-|inside|same_strand|ISCro1\n', 'HG941718.1_4171182-4171859:+\n']
Cluster 27: ['1244656_00845|1244656|-|inside|same_strand|ISCro1\n', 'HG941718.1_4171859-4172206:+\n']
Cluster 28: ['1244656_00846|1244656|-|inside|same_strand|ISCro1\n', 'HG941718.1_4172226-4173797:+\n']
Cluster 29: ['1244674_00863|1244674|-|upstream|opposite_strand|IS682\n', 'HG941718.1_3333065-3333982:-\n']
Cluster 30: ['1244674_00871|1244674|disrupted|upstream|same_strand|IS2\n', 'HG941718.1_3325081-3326067:-\n']
Cluster 31: ['1244674_00873|1244674|-|inside|same_strand|IS2\n', 'HG941718.1_3323701-3324614:-\n']
Cluster 32: ['1244674_00874|1244674|-|downstream|same_strand|IS2\n', 'HG941718.1_3321111-3323201:-\n']
Cluster 33: ['1244674_00875|1244674|-|upstream|opposite_strand|ISEc83\n', 'HG941718.1_3320007-3320249:-\n']
Cluster 34: ['1244674_00877|1244674|-|downstream|opposite_strand|ISEc45\n', 'HG941718.1_3319138-3319353:-\n']
Cluster 35: ['1244764_01146|1244764|disrupted|upstream|same_strand|IS609\n', 'HG941718.1_3821868-3823592:-\n']
Cluster 36: ['1244936_01276|1244936|-|downstream|opposite_strand|IS1203\n', 'HG941718.1_3292382-3292615:+\n']
Cluster 37: ['1244994_01721|1244994|-|upstream|same_strand|ISKpn42\n', 'HG941718.1_3358737-3359630:+\n']
Cluster 38: ['1244994_01722|1244994|-|inside|same_strand|ISKpn42\n', 'HG941718.1_3360089-3360271:+\n']
Cluster 39: ['1244994_01723|1244994|-|inside|same_strand|ISEc10\n', 'HG941718.1_3360620-3362119:+\n']
Cluster 40: ['1244994_01725|1244994|-|downstream|same_strand|ISEc10\n', 'HG941718.1_3363497-3364480:+\n']
Cluster 41: ['1245002_02024|1245002|disrupted|upstream|same_strand|ISCfr4\n', 'HG941718.1_1365153-1365521:+\n']
Cluster 42: ['1245002_02025|1245002|-|inside|same_strand|ISCfr4\n', 'HG941718.1_1365699-1366323:+\n']
Cluster 43: ['1245002_02026|1245002|-|downstream|same_strand|ISCfr4\n', 'HG941718.1_1366518-1369175:+\n']
Cluster 44: ['1245002_02030|1245002|disrupted|downstream|opposite_strand|ISSen3\n', 'HG941718.1_1371050-1371247:+\n']
Cluster 45: ['1245022_02113|1245022|disrupted|upstream|same_strand|MITEEc1\n', 'HG941718.1_3237500-3238663:-\n']
Cluster 46: ['1245022_02114|1245022|disrupted|downstream|same_strand|MITEEc1\n', 'HG941718.1_3236207-3237286:-\n']
Cluster 47: ['1245048_03746|1245048|-|inside|same_strand|ISEc9\n', 'HG941718.1_4937619-4938881:+\n']
Cluster 48: ['1245048_03748|1245048|upregulated|downstream|same_strand|ISEc9\n', 'HG941718.1_4940404-4941549:+\n']
Cluster 49: ['1245062_04536|1245062|-|downstream|opposite_strand|ISEc38\n', 'HG941718.1_2242649-2243683:+\n']
Cluster 50: ['1245088_04557|1245088|-|upstream|same_strand|ISEc47\n', 'HG941718.1_2279690-2280019:-\n']
Cluster 51: ['1245096_04606|1245096|-|inside|same_strand|ISEc1\n', 'HG941718.1_1647673-1648809:+\n']
Cluster 52: ['1245106_04639|1245106|-|inside|same_strand|ISSen10\n', 'HG941718.1_4156109-4156588:-\n']
Cluster 53: ['1245106_04640|1245106|disrupted|downstream|same_strand|ISSen10\n', 'HG941718.1_4155643-4156125:-\n', 'HG941718.1_4182223-4182633:-\n']
Cluster 54: ['1245118_04670|1245118|-|flanking|opposite_strand|ISEc23\n', 'HG941718.1_4924600-4924836:-\n']
Cluster 55: ['1245118_04678|1245118|-|downstream|opposite_strand|ISEc13\n', 'HG941718.1_4916875-4917639:-\n']</code></pre>
</div>
</div>
<p>Tried to filter first the truth CDS region that near to insertion elemeent, extraxt the sequence and then combined with predicted CDS from eris, tehn run clustering.</p>
<div id="0e1c33eb" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>grep <span class="st">"^HG941718</span><span class="er">\</span><span class="st">.1"</span> ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958_genomic_sorted.cds.edit.bed <span class="op">|</span> bedtools slop <span class="op">-</span>i <span class="op">-</span> <span class="op">-</span>g ec958.genome.size <span class="op">-</span>b <span class="dv">100000</span> <span class="op">|</span> bedtools intersect <span class="op">-</span>a <span class="op">-</span> <span class="op">-</span>b ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>ec958_IS.reannotated.<span class="bu">sorted</span>.bed <span class="op">&gt;</span> temp</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>seqkit subseq <span class="op">--</span>bed temp ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.fasta <span class="op">&gt;</span> cds_truth_with_is_intersect.fna</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>rm temp</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat cds_truth_with_is_intersect.fna cds_gfa_shovill_is.fna <span class="op">&gt;</span> combined_cds_truth_eris.fna</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mmseqs easy<span class="op">-</span>cluster combined_cds_truth_eris.fna clusterCDS tmp <span class="op">--</span><span class="bu">min</span><span class="op">-</span>seq<span class="op">-</span><span class="bu">id</span> <span class="fl">0.8</span> <span class="op">-</span>c <span class="fl">0.8</span> <span class="op">-</span>s <span class="dv">7</span> <span class="op">--</span>threads <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ad3b1fc4" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="op">=</span> defaultdict(<span class="bu">list</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"clusterCDS_cluster.tsv"</span>) <span class="im">as</span> entries:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> entry <span class="kw">in</span> entries.readlines():</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    cluster, member <span class="op">=</span> entry.split(<span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    clusters[cluster].append(member)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(clusters)<span class="sc">}</span><span class="ss"> clusters"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># classify clusters</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>truth_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>predicted_only <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>both <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>truth_clusters <span class="op">=</span> []</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>predicted_clusters <span class="op">=</span> []</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>both_clusters <span class="op">=</span> []</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster_id, members <span class="kw">in</span> clusters.items():</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    has_truth <span class="op">=</span> <span class="bu">any</span>(m.startswith(<span class="st">"HG941718.1"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    has_predicted <span class="op">=</span> <span class="bu">any</span>(<span class="kw">not</span> m.startswith(<span class="st">"HG941718.1"</span>) <span class="cf">for</span> m <span class="kw">in</span> members)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> has_truth <span class="kw">and</span> has_predicted:</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        both <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        both_clusters.append(cluster_id)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_truth:</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>        truth_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        truth_clusters.append(cluster_id)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> has_predicted:</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>        predicted_only <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        predicted_clusters.append(cluster_id)</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib_venn <span class="im">import</span> venn2</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># sizes</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>only_truth <span class="op">=</span> <span class="bu">len</span>(truth_clusters)</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>only_predicted <span class="op">=</span> <span class="bu">len</span>(predicted_clusters)</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>overlap <span class="op">=</span> <span class="bu">len</span>(both_clusters)</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Venn diagram</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>venn2(subsets<span class="op">=</span>(only_truth, only_predicted, overlap),</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>      set_labels<span class="op">=</span>(<span class="st">"TRUTH"</span>, <span class="st">"predicted CDS"</span>))</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cluster overlap"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters with both TRUTH and predicted:"</span>, both)</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only TRUTH:"</span>, truth_only)</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Clusters only predicted:"</span>, predicted_only)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 300 clusters</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week11_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Clusters with both TRUTH and predicted: 14
Clusters only TRUTH: 127
Clusters only predicted: 159</code></pre>
</div>
</div>
</section>
<section id="run-eris-with-annotation-file" class="level5">
<h5 class="anchored" data-anchor-id="run-eris-with-annotation-file">Run eris with annotation file</h5>
<p>Prepare the annotation file in bed file with something like this tat eris will accept it:</p>
<div id="65a848e6" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>awk <span class="st">'BEGIN{OFS="</span><span class="ch">\t</span><span class="st">"} {$7="."; $8="CDS"; $9="0"; $10="ID=" $4 ";source=genbank"; print $0}'</span>  ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958_genomic_sorted.cds.edit.bed <span class="op">&gt;</span> ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.bed</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head <span class="op">-</span>n <span class="dv">5</span> ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.bed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>HG941718.1  189 255 cds-WP_001386572.1  .   +   .   CDS 0   ID=cds-WP_001386572.1;source=genbank
HG941718.1  336 2799    cds-WP_001264707.1  .   +   .   CDS 0   ID=cds-WP_001264707.1;source=genbank
HG941719.1  407 626 cds-WP_000813634.1  .   +   .   CDS 0   ID=cds-WP_000813634.1;source=genbank
HG941720.1  624 1332    cds-WP_001296720.1  .   +   .   CDS 0   ID=cds-WP_001296720.1;source=genbank
HG941719.1  627 933 cds-WP_001159868.1  .   +   .   CDS 0   ID=cds-WP_001159868.1;source=genbank</code></pre>
</div>
</div>
<div id="9c23be80" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>eris scan ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.fasta <span class="op">-</span>a ..<span class="op">/</span>..<span class="op">/</span>data<span class="op">/</span>ecoli<span class="op">/</span>EC958.bed <span class="op">&gt;</span> eris<span class="op">-</span>outputs<span class="op">/</span>eris_anot.tsv</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>head <span class="op">-</span>n <span class="dv">10</span> eris<span class="op">-</span>outputs<span class="op">/</span>eris_anot.tsv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Genome  Feature Type    Contig  Start   End Strand  Partial Element Element_distance    Element_location    Element_strand  Element_effect  Percent_identity    Percent_coverage    Name    Family  Group   Synonyms    Origin  IR  DR
EC958   cds-EC958_RS01070   CDS HG941718.1  233363  233726  -1  False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    1bp upstream    opposite strand disrupted   -   -   None    -   -   -   -   -   -
EC958   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    mobile_element  HG941718.1  233727  236259  1   False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    -   -   -   -   99.96050552922591   100.0   ISEc23  IS66        None    Escherichia coli    20/24   8
EC958   cds-WP_000422741.1  CDS HG941718.1  233812  234238  1   False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    -   inside  same strand -   -   -   None    -   -   -   -   -   -
EC958   cds-WP_000624722.1  CDS HG941718.1  234234  234585  1   False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    -   inside  same strand -   -   -   None    -   -   -   -   -   -
EC958   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1_promoter_1 regulatory  HG941718.1  234579  234610  1   False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    -   inside  -   -   -   -   -   -   -   -   -   -   -
EC958   cds-WP_000080195.1  CDS HG941718.1  234615  236229  1   False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    -   inside  same strand -   -   -   None    -   -   -   -   -   -
EC958   cds-EC958_RS01090   CDS HG941718.1  236260  236728  -1  False   bef8e9bb-25fd-43d3-ad80-baf4b79a70f1    1bp downstream  opposite strand disrupted   -   -   None    -   -   -   -   -   -
EC958   cds-WP_001036491.1  CDS HG941718.1  813465  814899  1   False   1fdcdb6f-47e2-4eb9-93c3-f406137919f0    3bp downstream  opposite strand disrupted   -   -   None    -   -   -   -   -   -
EC958   1fdcdb6f-47e2-4eb9-93c3-f406137919f0    mobile_element  HG941718.1  814902  815025  -1  False   1fdcdb6f-47e2-4eb9-93c3-f406137919f0    -   -   -   -   96.7479674796748    100.0   MITEEc1 IS630       None    Escherichia coli    18/23   2</code></pre>
</div>
</div>


</section>
</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/adimascf\.github\.io\/logbook-IS\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>